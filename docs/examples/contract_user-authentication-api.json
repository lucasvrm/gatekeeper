{
  "schemaVersion": "1.0.0",
  "slug": "user-authentication-api",
  "title": "User Authentication API with JWT Tokens",
  "mode": "STRICT",
  "scope": "external",
  "changeType": "new",
  "criticality": "high",
  "targetArtifacts": [
    "src/api/auth/AuthController.ts",
    "src/services/TokenService.ts"
  ],
  "owners": ["@backend-team"],
  "createdAt": "2026-01-18T10:30:00Z",
  "clauses": [
    {
      "id": "CL-AUTH-001",
      "kind": "behavior",
      "normativity": "MUST",
      "title": "User receives JWT token on successful login",
      "spec": "When a user submits valid credentials via POST /api/auth/login, then the response status is 200 and the body contains a valid JWT token in the 'token' field.",
      "when": [
        "User account exists in database",
        "User account is not locked",
        "Password matches stored hash"
      ],
      "inputs": {
        "email": "string (valid email format)",
        "password": "string (min 8 characters)"
      },
      "outputs": {
        "status": "200",
        "token": "string (JWT format)",
        "expiresIn": "number (seconds)"
      },
      "observables": ["http", "db-effect"],
      "tags": ["authentication", "jwt", "happy-path"]
    },
    {
      "id": "CL-AUTH-002",
      "kind": "error",
      "normativity": "MUST",
      "title": "Invalid credentials return 401",
      "spec": "When a user submits invalid credentials via POST /api/auth/login, then the response status is 401 and the body contains error code AUTH_INVALID_CREDENTIALS.",
      "inputs": {
        "email": "string (any)",
        "password": "string (incorrect)"
      },
      "outputs": {
        "status": "401",
        "errorCode": "AUTH_INVALID_CREDENTIALS"
      },
      "observables": ["http"],
      "negativeCases": [
        "Wrong password returns 401",
        "Non-existent email returns 401",
        "Empty password returns 401"
      ],
      "tags": ["authentication", "error-handling", "sad-path"]
    },
    {
      "id": "CL-AUTH-003",
      "kind": "security",
      "normativity": "MUST",
      "title": "Password never appears in logs or responses",
      "spec": "When authentication occurs (success or failure), then password values must not appear in any log entries or HTTP responses.",
      "observables": ["log", "http"],
      "negativeCases": [
        "Check logs do not contain plaintext passwords",
        "Check error responses do not echo passwords"
      ],
      "tags": ["security", "privacy", "invariant"]
    }
  ],
  "assertionSurface": {
    "http": {
      "endpoints": [
        {
          "method": "POST",
          "path": "/api/auth/login"
        }
      ],
      "statusCodes": [200, 400, 401, 500]
    },
    "errors": {
      "codes": ["AUTH_INVALID_CREDENTIALS", "AUTH_ACCOUNT_LOCKED"]
    }
  },
  "testMapping": {
    "format": "comment_tags",
    "allowMultiple": true,
    "allowUntagged": false
  },
  "expectedCoverage": {
    "minTestsPerClause": 1,
    "minTestsForMUST": 2,
    "minNegativeTestsForError": 1
  }
}
