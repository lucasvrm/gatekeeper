{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "AuthContract",
  "title": "Authentication Contract Schema",
  "description": "Schema para definição de contratos de autenticação e autorização",
  "type": "object",
  "required": ["type", "credentials"],
  "properties": {
    "type": {
      "type": "string",
      "enum": ["login", "register", "logout", "password_reset_request", "password_reset_confirm", "password_change", "email_verification", "social_login", "mfa_setup", "mfa_verify"],
      "description": "Tipo de fluxo de autenticação"
    },
    "description": {
      "type": "string",
      "description": "Descrição do fluxo"
    },
    "credentials": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/CredentialField"
      },
      "description": "Campos de credencial"
    },
    "passwordPolicy": {
      "$ref": "#/definitions/PasswordPolicy"
    },
    "session": {
      "$ref": "#/definitions/SessionConfig"
    },
    "security": {
      "$ref": "#/definitions/SecurityConfig"
    },
    "flows": {
      "$ref": "#/definitions/AuthFlows"
    },
    "messages": {
      "$ref": "#/definitions/AuthMessages"
    },
    "redirects": {
      "$ref": "#/definitions/Redirects"
    },
    "socialProviders": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/SocialProvider"
      },
      "description": "Provedores de login social"
    },
    "mfa": {
      "$ref": "#/definitions/MFAConfig"
    },
    "tests": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Lista de testes obrigatórios"
    }
  },
  "definitions": {
    "CredentialField": {
      "type": "object",
      "required": ["name", "type", "required"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Nome do campo"
        },
        "type": {
          "type": "string",
          "enum": ["email", "password", "text", "phone", "cpf", "checkbox"],
          "description": "Tipo do campo"
        },
        "label": {
          "type": "string",
          "description": "Label exibido"
        },
        "required": {
          "type": "boolean",
          "description": "Se é obrigatório"
        },
        "validation": {
          "type": "string",
          "description": "Regras de validação"
        },
        "errorMessages": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Mensagens de erro por tipo de validação"
        }
      }
    },
    "PasswordPolicy": {
      "type": "object",
      "properties": {
        "minLength": {
          "type": "integer",
          "minimum": 6,
          "default": 8,
          "description": "Comprimento mínimo"
        },
        "maxLength": {
          "type": "integer",
          "default": 128,
          "description": "Comprimento máximo"
        },
        "requireUppercase": {
          "type": "boolean",
          "default": false,
          "description": "Requer letra maiúscula"
        },
        "requireLowercase": {
          "type": "boolean",
          "default": false,
          "description": "Requer letra minúscula"
        },
        "requireNumber": {
          "type": "boolean",
          "default": true,
          "description": "Requer número"
        },
        "requireSpecial": {
          "type": "boolean",
          "default": false,
          "description": "Requer caractere especial"
        },
        "noSpaces": {
          "type": "boolean",
          "default": true,
          "description": "Não permite espaços"
        },
        "showStrengthIndicator": {
          "type": "boolean",
          "default": true,
          "description": "Mostrar indicador de força"
        },
        "showToggle": {
          "type": "boolean",
          "default": true,
          "description": "Mostrar botão de mostrar/esconder"
        }
      }
    },
    "SessionConfig": {
      "type": "object",
      "properties": {
        "duration": {
          "type": "string",
          "default": "24h",
          "description": "Duração padrão da sessão"
        },
        "rememberMeDuration": {
          "type": "string",
          "default": "30d",
          "description": "Duração com 'lembrar-me'"
        },
        "storage": {
          "type": "string",
          "enum": ["cookie", "httpOnly_cookie", "localStorage", "sessionStorage"],
          "default": "httpOnly_cookie",
          "description": "Onde armazenar o token"
        },
        "renewalStrategy": {
          "type": "string",
          "enum": ["sliding", "absolute"],
          "default": "sliding",
          "description": "Estratégia de renovação"
        },
        "allowConcurrent": {
          "type": "boolean",
          "default": true,
          "description": "Permite sessões simultâneas"
        },
        "maxConcurrentSessions": {
          "type": "integer",
          "description": "Máximo de sessões simultâneas"
        }
      }
    },
    "SecurityConfig": {
      "type": "object",
      "properties": {
        "bruteForce": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "maxAttempts": {
              "type": "integer",
              "default": 5
            },
            "lockoutDuration": {
              "type": "string",
              "default": "15m"
            },
            "countWindow": {
              "type": "string",
              "default": "1h"
            }
          }
        },
        "captcha": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "showAfterAttempts": {
              "type": "integer",
              "default": 3
            },
            "provider": {
              "type": "string",
              "enum": ["recaptcha", "hcaptcha", "turnstile"]
            }
          }
        },
        "emailVerification": {
          "type": "object",
          "properties": {
            "required": {
              "type": "boolean",
              "default": true
            },
            "allowLimitedAccess": {
              "type": "boolean",
              "default": true
            },
            "tokenExpiration": {
              "type": "string",
              "default": "24h"
            }
          }
        }
      }
    },
    "AuthFlows": {
      "type": "object",
      "properties": {
        "success": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/FlowStep"
          },
          "description": "Passos do fluxo de sucesso"
        },
        "errors": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ErrorFlow"
          },
          "description": "Fluxos de erro"
        }
      }
    },
    "FlowStep": {
      "type": "object",
      "required": ["step", "action"],
      "properties": {
        "step": {
          "type": "integer"
        },
        "actor": {
          "type": "string",
          "enum": ["user", "system"]
        },
        "action": {
          "type": "string"
        },
        "result": {
          "type": "string"
        }
      }
    },
    "ErrorFlow": {
      "type": "object",
      "required": ["scenario", "response"],
      "properties": {
        "scenario": {
          "type": "string",
          "description": "Cenário de erro"
        },
        "trigger": {
          "type": "string",
          "description": "O que causa o erro"
        },
        "response": {
          "type": "object",
          "properties": {
            "status": {
              "type": "integer"
            },
            "message": {
              "type": "string"
            },
            "code": {
              "type": "string"
            }
          }
        },
        "uiEffect": {
          "type": "string",
          "description": "Efeito na UI"
        }
      }
    },
    "AuthMessages": {
      "type": "object",
      "properties": {
        "errors": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Mensagens de erro"
        },
        "success": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Mensagens de sucesso"
        },
        "labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Labels de UI"
        }
      }
    },
    "Redirects": {
      "type": "object",
      "properties": {
        "afterSuccess": {
          "type": "string",
          "description": "Destino após sucesso"
        },
        "afterLogout": {
          "type": "string",
          "description": "Destino após logout"
        },
        "unauthenticated": {
          "type": "string",
          "description": "Destino quando não autenticado"
        },
        "saveIntended": {
          "type": "boolean",
          "default": true,
          "description": "Salvar URL pretendida"
        }
      }
    },
    "SocialProvider": {
      "type": "object",
      "required": ["provider"],
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["google", "facebook", "apple", "microsoft", "github", "linkedin"]
        },
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "scopes": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Scopes OAuth"
        },
        "allowAccountCreation": {
          "type": "boolean",
          "default": true
        },
        "allowAccountLinking": {
          "type": "boolean",
          "default": true
        }
      }
    },
    "MFAConfig": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false
        },
        "required": {
          "type": "boolean",
          "default": false
        },
        "methods": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["totp", "sms", "email", "backup_codes"]
          },
          "default": ["totp"]
        },
        "recoveryCodesCount": {
          "type": "integer",
          "default": 10
        }
      }
    }
  }
}
