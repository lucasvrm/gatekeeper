{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "FeatureContract",
  "title": "Feature Contract Schema",
  "description": "Schema para definição de contratos de funcionalidades/fluxos completos",
  "type": "object",
  "required": ["name", "userStory", "happyPath"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Nome da funcionalidade"
    },
    "description": {
      "type": "string",
      "description": "Descrição breve da funcionalidade"
    },
    "epic": {
      "type": "string",
      "description": "Epic/módulo ao qual pertence"
    },
    "userStory": {
      "$ref": "#/definitions/UserStory"
    },
    "happyPath": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/FlowStep"
      },
      "minItems": 2,
      "description": "Fluxo principal quando tudo dá certo"
    },
    "alternativePaths": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/AlternativePath"
      },
      "description": "Fluxos alternativos e de erro"
    },
    "businessRules": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/BusinessRule"
      },
      "description": "Regras de negócio aplicáveis"
    },
    "entryPoints": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/EntryPoint"
      },
      "description": "Pontos de entrada para o fluxo"
    },
    "exitPoints": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/ExitPoint"
      },
      "description": "Pontos de saída do fluxo"
    },
    "components": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Componentes de UI envolvidos"
    },
    "endpoints": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Endpoints de API envolvidos"
    },
    "integrations": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Integration"
      },
      "description": "Integrações externas"
    },
    "acceptanceCriteria": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Critérios de aceite"
    },
    "tests": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Lista de testes obrigatórios"
    }
  },
  "definitions": {
    "UserStory": {
      "type": "object",
      "required": ["as", "iWant", "soThat"],
      "properties": {
        "as": {
          "type": "string",
          "description": "Tipo de usuário",
          "examples": ["visitante", "usuário logado", "administrador"]
        },
        "iWant": {
          "type": "string",
          "description": "O que o usuário quer fazer"
        },
        "soThat": {
          "type": "string",
          "description": "Benefício/razão"
        }
      }
    },
    "FlowStep": {
      "type": "object",
      "required": ["step", "actor", "action", "result"],
      "properties": {
        "step": {
          "type": "integer",
          "minimum": 1,
          "description": "Número do passo"
        },
        "actor": {
          "type": "string",
          "enum": ["user", "system"],
          "description": "Quem executa a ação"
        },
        "action": {
          "type": "string",
          "description": "Ação executada"
        },
        "result": {
          "type": "string",
          "description": "Resultado esperado"
        },
        "component": {
          "type": "string",
          "description": "Componente envolvido (se UI)"
        },
        "endpoint": {
          "type": "string",
          "description": "Endpoint envolvido (se API)"
        },
        "notes": {
          "type": "string",
          "description": "Observações adicionais"
        }
      }
    },
    "AlternativePath": {
      "type": "object",
      "required": ["name", "trigger", "steps"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Nome do fluxo alternativo"
        },
        "type": {
          "type": "string",
          "enum": ["error", "exception", "alternative", "abort"],
          "description": "Tipo do fluxo"
        },
        "trigger": {
          "type": "string",
          "description": "Condição que dispara este fluxo"
        },
        "fromStep": {
          "type": "integer",
          "description": "Passo do happy path onde pode ocorrer"
        },
        "steps": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/FlowStep"
          },
          "description": "Passos deste fluxo alternativo"
        },
        "outcome": {
          "type": "string",
          "description": "Resultado final deste fluxo"
        }
      }
    },
    "BusinessRule": {
      "type": "object",
      "required": ["rule"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Identificador da regra"
        },
        "rule": {
          "type": "string",
          "description": "Descrição da regra"
        },
        "enforcement": {
          "type": "string",
          "description": "Como a regra é garantida"
        },
        "violationMessage": {
          "type": "string",
          "description": "Mensagem quando violada"
        }
      }
    },
    "EntryPoint": {
      "type": "object",
      "required": ["location", "trigger"],
      "properties": {
        "location": {
          "type": "string",
          "description": "Onde está o ponto de entrada"
        },
        "trigger": {
          "type": "string",
          "description": "O que dispara a entrada"
        },
        "preconditions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Condições necessárias"
        }
      }
    },
    "ExitPoint": {
      "type": "object",
      "required": ["type", "destination"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["success", "cancel", "error", "timeout"],
          "description": "Tipo de saída"
        },
        "destination": {
          "type": "string",
          "description": "Para onde vai após sair"
        },
        "feedback": {
          "type": "string",
          "description": "Feedback mostrado ao sair"
        }
      }
    },
    "Integration": {
      "type": "object",
      "required": ["system", "action"],
      "properties": {
        "system": {
          "type": "string",
          "description": "Sistema externo"
        },
        "action": {
          "type": "string",
          "description": "Ação executada"
        },
        "async": {
          "type": "boolean",
          "description": "Se é assíncrono"
        },
        "mockBehavior": {
          "type": "string",
          "description": "Comportamento do mock em testes"
        }
      }
    }
  }
}
