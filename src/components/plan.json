{
  "outputId": "2026_01_19_001_ui-layout-standardization",
  "baseRef": "origin/main",
  "targetRef": "HEAD",
  "taskPrompt": "Padronização de Layout e Correções de UI: (1) Remover max-w-6xl mx-auto de new-validation-page.tsx para consistência com outras páginas; (2) Reorganizar botões em /runs/new: mudar justify-end para justify-start, texto 'Validar Contrato (Gates 0-1)' para 'Run Gates 0 e 1', adicionar testIds btn-run-gates e btn-cancel, remover botão 'Validar Execução (Gates 2-3)'; (3) Modal de upload: adicionar overflow-x-hidden no DialogContent e whitespace-pre-wrap break-all nos previews; (4) Labels de contagem em run-panel.tsx: mudar '4P' para '4 Passed', '0F' para '0 Failed', '1W' para '1 Warning', aumentar fonte de text-[10px] para text-[13px].",
  "dangerMode": false,
  "runType": "CONTRACT",
  "manifest": {
    "testFile": "ui-layout-standardization.spec.tsx",
    "files": [
      {
        "path": "src/components/new-validation-page.tsx",
        "action": "MODIFY",
        "reason": "Remover max-w-6xl mx-auto, reorganizar botões, mudar texto, adicionar testIds, remover botão execução"
      },
      {
        "path": "src/components/file-upload-dialog.tsx",
        "action": "MODIFY",
        "reason": "Adicionar overflow-x-hidden no DialogContent e whitespace-pre-wrap break-all nos previews"
      },
      {
        "path": "src/components/run-panel.tsx",
        "action": "MODIFY",
        "reason": "Mudar labels de contagem de formato abreviado para expandido e aumentar fonte"
      }
    ]
  },
  "testFilePath": "ui-layout-standardization.spec.tsx",
  "testFileContent": "/**\n * @fileoverview Tests for UI Layout Standardization\n * @contract ui-layout-standardization\n * \n * Validates UI changes:\n * - Page layout padding standardization\n * - Button text, position, and testIds\n * - Validator count labels format\n * - Modal overflow handling\n */\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest'\nimport { render, screen } from '@testing-library/react'\nimport { BrowserRouter } from 'react-router-dom'\n\n// Mock the api module\nvi.mock('@/lib/api', () => ({\n  api: {\n    runs: {\n      create: vi.fn(),\n      uploadFiles: vi.fn(),\n      bypassValidator: vi.fn(),\n    },\n  },\n}))\n\n// Mock sonner toast\nvi.mock('sonner', () => ({\n  toast: {\n    success: vi.fn(),\n    error: vi.fn(),\n  },\n}))\n\n// Import components after mocks\nimport { NewValidationPage } from '@/components/new-validation-page'\nimport { RunPanel } from '@/components/run-panel'\nimport { FileUploadDialog } from '@/components/file-upload-dialog'\n\n// Helper to render with router\nconst renderWithRouter = (component: React.ReactNode) => {\n  return render(\n    <BrowserRouter>\n      {component}\n    </BrowserRouter>\n  )\n}\n\n// Mock run data for RunPanel tests\nconst mockRunWithResults = {\n  id: 'test-run-123',\n  outputId: 'output-123',\n  status: 'PASSED' as const,\n  passed: true,\n  runType: 'CONTRACT' as const,\n  currentGate: 1,\n  failedAt: null,\n  taskPrompt: 'Test task prompt',\n  createdAt: new Date().toISOString(),\n  updatedAt: new Date().toISOString(),\n  gateResults: [\n    {\n      id: 'gate-0',\n      gateNumber: 0,\n      gateName: 'SANITIZATION',\n      status: 'PASSED' as const,\n      passed: true,\n      passedCount: 4,\n      failedCount: 0,\n      warningCount: 1,\n      skippedCount: 0,\n      completedAt: new Date().toISOString(),\n    },\n    {\n      id: 'gate-1',\n      gateNumber: 1,\n      gateName: 'CONTRACT',\n      status: 'PASSED' as const,\n      passed: true,\n      passedCount: 8,\n      failedCount: 2,\n      warningCount: 0,\n      skippedCount: 1,\n      completedAt: new Date().toISOString(),\n    },\n  ],\n  validatorResults: [],\n}\n\ndescribe('NewValidationPage - Layout Standardization', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  // @clause CL-UI-001\n  it('should render page container with correct padding classes', () => {\n    const { container } = renderWithRouter(<NewValidationPage />)\n    const mainContainer = container.querySelector('div.p-8')\n    expect(mainContainer).toBeTruthy()\n    expect(mainContainer?.className).toContain('p-8')\n    expect(mainContainer?.className).toContain('space-y-6')\n    expect(mainContainer?.className).not.toContain('max-w-6xl')\n    expect(mainContainer?.className).not.toContain('mx-auto')\n  })\n\n  // @clause CL-UI-002\n  it('should display Run Gates button with correct testId when valid', () => {\n    renderWithRouter(<NewValidationPage />)\n    const runGatesButton = screen.getByTestId('btn-run-gates')\n    expect(runGatesButton).toBeInTheDocument()\n    expect(runGatesButton).toHaveTextContent('Run Gates 0 e 1')\n    expect(runGatesButton).toHaveAttribute('type', 'submit')\n  })\n\n  // @clause CL-UI-003\n  it('should display Cancel button with correct testId when valid', () => {\n    renderWithRouter(<NewValidationPage />)\n    const cancelButton = screen.getByTestId('btn-cancel')\n    expect(cancelButton).toBeInTheDocument()\n    expect(cancelButton).toHaveTextContent('Cancelar')\n    expect(cancelButton).toHaveAttribute('type', 'button')\n  })\n\n  // @clause CL-UI-004\n  it('fails to find Validar Execução button because it was removed', () => {\n    renderWithRouter(<NewValidationPage />)\n    const execButton = screen.queryByText(/Validar Execução/i)\n    expect(execButton).not.toBeInTheDocument()\n    const gatesText = screen.queryByText(/Gates 2-3/i)\n    expect(gatesText).not.toBeInTheDocument()\n  })\n\n  // @clause CL-UI-005\n  it('should align buttons to left with justify-start class', () => {\n    const { container } = renderWithRouter(<NewValidationPage />)\n    const buttonContainer = container.querySelector('.flex.items-center.gap-3')\n    expect(buttonContainer).toBeTruthy()\n    expect(buttonContainer?.className).toContain('justify-start')\n    expect(buttonContainer?.className).not.toContain('justify-end')\n  })\n\n  // @clause CL-UI-005\n  it('should order Run Gates button before Cancel button when rendered', () => {\n    const { container } = renderWithRouter(<NewValidationPage />)\n    const buttonContainer = container.querySelector('.flex.items-center.justify-start.gap-3')\n    expect(buttonContainer).toBeTruthy()\n    const buttons = buttonContainer?.querySelectorAll('button')\n    expect(buttons?.length).toBeGreaterThanOrEqual(2)\n    expect(buttons?.[0]).toHaveAttribute('type', 'submit')\n    expect(buttons?.[1]).toHaveAttribute('type', 'button')\n  })\n})\n\ndescribe('RunPanel - Validator Count Labels', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  // @clause CL-UI-006\n  it('should display expanded Passed label when validators pass', () => {\n    renderWithRouter(\n      <RunPanel \n        run={mockRunWithResults} \n        onUploadSuccess={() => {}}\n      />\n    )\n    expect(screen.getByText(/4 Passed/)).toBeInTheDocument()\n    expect(screen.getByText(/8 Passed/)).toBeInTheDocument()\n  })\n\n  // @clause CL-UI-007\n  it('should display expanded Failed label when validators fail', () => {\n    renderWithRouter(\n      <RunPanel \n        run={mockRunWithResults} \n        onUploadSuccess={() => {}}\n      />\n    )\n    expect(screen.getByText(/0 Failed/)).toBeInTheDocument()\n    expect(screen.getByText(/2 Failed/)).toBeInTheDocument()\n  })\n\n  // @clause CL-UI-008\n  it('should use larger font size text-[13px] for count labels', () => {\n    const { container } = renderWithRouter(\n      <RunPanel \n        run={mockRunWithResults} \n        onUploadSuccess={() => {}}\n      />\n    )\n    const countContainers = container.querySelectorAll('.flex.items-center.gap-3')\n    const hasLargerFont = Array.from(countContainers).some(\n      el => el.className.includes('text-[13px]')\n    )\n    expect(hasLargerFont).toBe(true)\n  })\n})\n\ndescribe('FileUploadDialog - Overflow Handling', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  // @clause CL-UI-009\n  it('should have overflow-x-hidden on DialogContent when open', () => {\n    const { container } = render(\n      <FileUploadDialog\n        open={true}\n        onClose={() => {}}\n        runId=\"test-run-123\"\n      />\n    )\n    const dialogContent = container.querySelector('[class*=\"max-w-3xl\"]')\n    expect(dialogContent).toBeTruthy()\n    expect(dialogContent?.className).toContain('overflow-x-hidden')\n  })\n})\n",
  "contract": {
    "schemaVersion": "1.0",
    "slug": "ui-layout-standardization",
    "title": "Padronização de Layout e Correções de UI",
    "mode": "STRICT",
    "changeType": "modify",
    "criticality": "MEDIUM",
    "clauses": [
      {
        "id": "CL-UI-001",
        "kind": "ui",
        "normativity": "MUST",
        "when": "O usuário navega para /runs/new",
        "then": "O container principal possui p-8 space-y-6 e NÃO possui max-w-6xl ou mx-auto"
      },
      {
        "id": "CL-UI-002",
        "kind": "ui",
        "normativity": "MUST",
        "when": "O usuário visualiza /runs/new",
        "then": "Existe botão com data-testid='btn-run-gates', texto 'Run Gates 0 e 1' e type='submit'"
      },
      {
        "id": "CL-UI-003",
        "kind": "ui",
        "normativity": "MUST",
        "when": "O usuário visualiza /runs/new",
        "then": "Existe botão com data-testid='btn-cancel', texto 'Cancelar' e type='button'"
      },
      {
        "id": "CL-UI-004",
        "kind": "ui",
        "normativity": "MUST",
        "when": "O usuário visualiza /runs/new",
        "then": "NÃO existe elemento com texto 'Validar Execução' ou 'Gates 2-3'"
      },
      {
        "id": "CL-UI-005",
        "kind": "ui",
        "normativity": "MUST",
        "when": "O usuário visualiza /runs/new",
        "then": "Container dos botões possui justify-start e NÃO possui justify-end"
      },
      {
        "id": "CL-UI-006",
        "kind": "ui",
        "normativity": "MUST",
        "when": "O usuário visualiza gates com validators aprovados",
        "then": "Label mostra 'X Passed' ao invés de 'XP'"
      },
      {
        "id": "CL-UI-007",
        "kind": "ui",
        "normativity": "MUST",
        "when": "O usuário visualiza gates com validators reprovados",
        "then": "Label mostra 'X Failed' ao invés de 'XF'"
      },
      {
        "id": "CL-UI-008",
        "kind": "ui",
        "normativity": "MUST",
        "when": "O usuário visualiza labels de contagem",
        "then": "Fonte é text-[13px] ao invés de text-[10px]"
      },
      {
        "id": "CL-UI-009",
        "kind": "ui",
        "normativity": "MUST",
        "when": "O modal de upload é aberto",
        "then": "DialogContent possui overflow-x-hidden"
      }
    ],
    "assertionSurface": {
      "http": {
        "methods": [],
        "successStatuses": [],
        "errorStatuses": [],
        "errorCodes": [],
        "payloadPaths": []
      },
      "ui": {
        "routes": [
          "/runs/new",
          "/runs/{id}"
        ],
        "testIds": [
          "btn-run-gates",
          "btn-cancel"
        ],
        "roles": [
          "button",
          "dialog"
        ],
        "ariaLabels": []
      },
      "effects": []
    },
    "testMapping": {
      "tagPattern": "// @clause"
    }
  }
}