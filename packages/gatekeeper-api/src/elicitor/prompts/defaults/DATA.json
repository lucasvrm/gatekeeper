{
  "$schema": "./DataContract.json",
  "$comment": "Valores default para quando o usuário responder 'não sei' ou não responder",
  
  "baseFields": {
    "id": {
      "type": "uuid",
      "generated": true,
      "immutable": true
    },
    "createdAt": {
      "type": "datetime",
      "generated": true,
      "immutable": true,
      "defaultValue": "now()"
    },
    "updatedAt": {
      "type": "datetime",
      "generated": true,
      "autoUpdate": true
    },
    "createdBy": {
      "type": "relation",
      "target": "User",
      "nullable": true,
      "generated": "from_session"
    }
  },
  
  "deletion": {
    "type": "soft",
    "field": "deletedAt",
    "retentionPeriod": "30d",
    "excludeFromQueries": true,
    "cascadeType": "soft"
  },
  
  "audit": {
    "enabled": true,
    "level": "basic",
    "fields": {
      "basic": ["updatedAt", "updatedBy"],
      "full": ["all_changes_as_json"]
    },
    "trackFields": "all"
  },
  
  "validation": {
    "timing": "before_save",
    "failFast": false,
    "byFieldType": {
      "string": {
        "trim": true,
        "maxLength": 1000
      },
      "email": {
        "format": "email",
        "lowercase": true,
        "maxLength": 255
      },
      "phone": {
        "digitsOnly": true,
        "minLength": 10,
        "maxLength": 11
      },
      "cpf": {
        "digitsOnly": true,
        "length": 11,
        "validateCheckDigit": true
      },
      "cnpj": {
        "digitsOnly": true,
        "length": 14,
        "validateCheckDigit": true
      },
      "url": {
        "format": "uri",
        "protocols": ["http", "https"]
      },
      "date": {
        "format": "YYYY-MM-DD"
      },
      "datetime": {
        "format": "ISO8601"
      },
      "money": {
        "type": "decimal",
        "precision": 2,
        "minimum": 0
      },
      "integer": {
        "type": "integer"
      },
      "boolean": {
        "strict": true
      },
      "enum": {
        "strict": true,
        "caseSensitive": false
      }
    }
  },
  
  "permissions": {
    "create": {
      "roles": ["authenticated"],
      "description": "Usuários autenticados podem criar"
    },
    "read": {
      "roles": ["authenticated"],
      "scope": "own_or_admin",
      "description": "Lê próprios registros ou admin lê todos"
    },
    "update": {
      "roles": ["owner", "admin"],
      "description": "Dono ou admin podem editar"
    },
    "delete": {
      "roles": ["admin"],
      "description": "Apenas admin pode excluir"
    }
  },
  
  "relationships": {
    "onParentDelete": "restrict",
    "onParentUpdate": "cascade",
    "orphanBehavior": "prevent"
  },
  
  "uniqueConstraints": {
    "byFieldType": {
      "email": true,
      "cpf": true,
      "cnpj": true,
      "slug": true
    }
  },
  
  "indexes": {
    "autoCreate": ["unique_fields", "foreign_keys", "frequently_filtered"],
    "description": "Índices automáticos para campos únicos, FKs e filtros comuns"
  },
  
  "sideEffects": {
    "onCreate": {
      "enabled": false,
      "actions": []
    },
    "onUpdate": {
      "enabled": false,
      "actions": []
    },
    "onDelete": {
      "enabled": false,
      "actions": []
    }
  },
  
  "byOperationType": {
    "create": {
      "returnCreated": true,
      "triggerEvents": ["entity.created"],
      "defaults": "apply_field_defaults"
    },
    "update": {
      "partial": true,
      "returnUpdated": true,
      "triggerEvents": ["entity.updated"],
      "preventOverwrite": {
        "enabled": false,
        "field": "version"
      }
    },
    "delete": {
      "type": "soft",
      "returnDeleted": false,
      "triggerEvents": ["entity.deleted"]
    },
    "restore": {
      "enabled": true,
      "triggerEvents": ["entity.restored"]
    },
    "bulkCreate": {
      "maxItems": 100,
      "stopOnError": false,
      "returnCreated": true
    },
    "bulkUpdate": {
      "maxItems": 100,
      "stopOnError": false
    },
    "bulkDelete": {
      "maxItems": 100,
      "requireConfirmation": true
    }
  },
  
  "commonFields": {
    "status": {
      "type": "enum",
      "values": ["active", "inactive", "pending", "archived"],
      "default": "active",
      "filterable": true
    },
    "priority": {
      "type": "enum",
      "values": ["low", "medium", "high", "urgent"],
      "default": "medium"
    },
    "tags": {
      "type": "array",
      "items": "string",
      "maxItems": 10
    },
    "notes": {
      "type": "text",
      "maxLength": 5000,
      "nullable": true
    },
    "metadata": {
      "type": "json",
      "nullable": true,
      "description": "Dados extras flexíveis"
    }
  },
  
  "errorMessages": {
    "required": "{field} é obrigatório",
    "invalid": "{field} inválido",
    "tooLong": "{field} deve ter no máximo {max} caracteres",
    "tooShort": "{field} deve ter no mínimo {min} caracteres",
    "unique": "{field} já está em uso",
    "notFound": "{entity} não encontrado",
    "forbidden": "Sem permissão para {action} {entity}",
    "invalidFormat": "Formato de {field} inválido",
    "outOfRange": "{field} deve estar entre {min} e {max}",
    "hasDependencies": "Não é possível excluir: existem {count} {dependency} vinculados"
  },
  
  "testDefaults": {
    "create": {
      "happyPath": [
        "creates with valid data",
        "applies default values",
        "generates id and timestamps",
        "enforces required fields"
      ],
      "sadPath": [
        "rejects missing required fields",
        "rejects invalid format",
        "rejects duplicate unique field",
        "rejects without permission"
      ]
    },
    "update": {
      "happyPath": [
        "updates with valid data",
        "updates only provided fields (partial)",
        "updates updatedAt timestamp"
      ],
      "sadPath": [
        "rejects non-existent id",
        "rejects invalid data",
        "rejects updating immutable fields",
        "rejects without permission"
      ]
    },
    "delete": {
      "happyPath": [
        "soft deletes successfully",
        "sets deletedAt timestamp",
        "excludes from normal queries"
      ],
      "sadPath": [
        "rejects non-existent id",
        "rejects without permission",
        "rejects when has dependencies"
      ]
    },
    "validation": [
      "validates email format",
      "validates required fields",
      "validates string length",
      "validates enum values",
      "validates unique constraints"
    ]
  }
}
