{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "plan_template.v3.json",
  "title": "Gatekeeper Plan Template v3",
  "description": "Template para plan.json com suporte a DELETE e reason obrigatorio",
  "version": "3.0",

  "template": {
    "outputId": "<YYYY_MM_DD_NNN_slug>",
    "taskPrompt": "<descricao da tarefa>",

    "manifest": {
      "testFile": "<path/to/test-file.mjs>",
      "files": [
        {
          "path": "<caminho/do/arquivo>",
          "action": "CREATE | MODIFY | DELETE",
          "reason": "<explicacao obrigatoria do porque>"
        }
      ]
    },

    "contract": {
      "schemaVersion": "1.0",
      "slug": "<slug-do-contrato>",
      "title": "<Titulo do Contrato>",
      "mode": "STRICT | RELAXED",
      "changeType": "new | enhancement | bugfix | refactor",
      "criticality": "low | medium | high | critical",

      "clauses": [
        {
          "id": "CL-XXX-001",
          "kind": "behavior | error | invariant | constraint",
          "normativity": "MUST | SHOULD | MAY",
          "when": "<condicao de ativacao>",
          "then": "<resultado esperado>"
        }
      ],

      "assertionSurface": {},
      "testMapping": {
        "tagPattern": "// @clause"
      }
    },

    "baseRef": "origin/main",
    "targetRef": "HEAD",
    "dangerMode": false,
    "runType": "CONTRACT | EXECUTION"
  },

  "examples": {
    "delete_with_impact": {
      "description": "Exemplo de DELETE com analise de impacto completa",
      "manifest": {
        "testFile": "tests/refactor/test-remove-legacy.mjs",
        "files": [
          {
            "path": "src/lib/legacy-utils.ts",
            "action": "DELETE",
            "reason": "Arquivo legado sendo removido - funcionalidade migrada para src/lib/modern-utils.ts"
          },
          {
            "path": "src/services/user.ts",
            "action": "MODIFY",
            "reason": "Atualizar import de legacy-utils para modern-utils"
          },
          {
            "path": "src/components/Form.tsx",
            "action": "MODIFY",
            "reason": "Atualizar import de legacy-utils para modern-utils"
          },
          {
            "path": "src/lib/deprecated-wrapper.ts",
            "action": "DELETE",
            "reason": "Wrapper de legacy-utils tambem removido - nao mais necessario"
          }
        ]
      }
    },

    "create_new_feature": {
      "description": "Exemplo de nova feature com CREATE e MODIFY",
      "manifest": {
        "testFile": "tests/features/test-new-feature.mjs",
        "files": [
          {
            "path": "src/features/new-feature.ts",
            "action": "CREATE",
            "reason": "Nova feature conforme requisitos do usuario"
          },
          {
            "path": "src/features/index.ts",
            "action": "MODIFY",
            "reason": "Exportar nova feature no barrel file"
          },
          {
            "path": "src/types/features.ts",
            "action": "MODIFY",
            "reason": "Adicionar tipos para nova feature"
          }
        ]
      }
    },

    "bugfix": {
      "description": "Exemplo de bugfix pontual",
      "manifest": {
        "testFile": "tests/fixes/test-null-check.mjs",
        "files": [
          {
            "path": "src/utils/parser.ts",
            "action": "MODIFY",
            "reason": "Adicionar null check para evitar crash quando input vazio"
          }
        ]
      }
    }
  },

  "validation_rules": {
    "manifest.files[].reason": {
      "required": true,
      "minLength": 10,
      "description": "Reason deve explicar claramente o porque da mudanca"
    },
    "manifest.files[].action": {
      "required": true,
      "enum": ["CREATE", "MODIFY", "DELETE"]
    },
    "delete_impact_check": {
      "description": "Para cada DELETE, verificar se importadores estao cobertos",
      "validator": "DELETE_DEPENDENCY_CHECK"
    }
  }
}
